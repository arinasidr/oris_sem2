{% extends 'base.html' %} {% block title %}{{ subject.name }}{% endblock %} {%
block content %}
<section class="subject-detail">
    <h2>{{ subject.name }}</h2>

    {% if tags %}
        <div class="subject-tags">
        {% for tag in tags %}
            <span class="tag">{{ tag }}</span>
        {% endfor %}
        </div>
    {% endif %}

    <a class="subjects-add" href="{{ url_for('add_task', subject_id=subject.id) }}">+ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</a>

    {% if tasks %}
        <ul class="tasks-list">
        {% for task in tasks %}
            <li class="task {% if task.is_completed %}task-done{% endif %}">
                <label class="task-item">
                <input type="checkbox" data-task-id="{{ task.id }}" {% if task.is_completed %}checked{% endif %} />

                <div class="task-info">
                    <span class="task-title">{{ task.title }}</span>
                    <span class="task-deadline">–î–µ–¥–ª–∞–π–Ω: {{ task.deadline }}</span>

                    {% if not task.is_completed %}
                        <span class="task-days">
                        {% if task.days_left > 0 %} ‚è∞ –û—Å—Ç–∞–ª–æ—Å—å {{ task.days_left }} –¥–Ω. 
                        {%elif task.days_left == 0 %} ‚ÄºÔ∏è –°–µ–≥–æ–¥–Ω—è –¥–µ–¥–ª–∞–π–Ω 
                        {% else %} üëé–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –Ω–∞ {{ -task.days_left }} –¥–Ω. 
                        {% endif %}
                        </span>
                    {% endif %}
                </div>
                </label>
            </li>
        {% endfor %}
        </ul>
  {% else %}
      <p>–ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç</p>
  {% endif %}
      <a href="{{ url_for('subjects')}}" class="back-link">–ö —Å–ø–∏—Å–∫—É –ø—Ä–µ–¥–º–µ—Ç–æ–≤</a>
</section>

<!-- —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —á–µ—Å—Ç–Ω–æ —Å –≥–ø—Ç, –º–æ–π —É—Ä–æ–≤–µ–Ω—å –¥–∂–∞–≤–∞—Å–∫—Ä–∏–ø—Ç –µ—â–µ –Ω–µ –Ω–∞—Å—Ç–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à......... -->
<script>
  document.querySelectorAll('.task-item input[type="checkbox"]').forEach(cb => {
    cb.addEventListener('change', () => {
      const taskId = cb.dataset.taskId;

      fetch(`/tasks/${taskId}/toggle`, {
        method: 'POST'
      })
      .then(() => {
        cb.closest('.task').classList.toggle('task-done');
      });
    });
  });
</script>
{% endblock %}
